$(document).ready(function(){function a(a){o.removeMarkers(),e.rows().remove(),e.draw(),$(a).each(function(){var a=this,t=a.name,n=a.geometry.location.G,i=a.geometry.location.K,c=a.vicinity,l="";l+="<h5>"+t+"</h5>",l+="<p>"+c+"</p>",l+="<button class='btn btn-success btn-block add_location' data-lat='"+n+"' data-lng='"+i+"'>Add Location</button>",e.row.add(["Add",a.name,a.vicinity,n,i]),e.draw(),o.addMarker({lat:n,lng:i,title:t,infoWindow:{content:l}})})}function t(t){i=new Array,l=t,service.nearbySearch({location:{lat:r,lng:d},radius:1e4,keyword:t},function(t,n,o){$(t).each(function(){i.push(this)}),a(i)})}function n(a,t,n,o){$.ajax({dataType:"json",url:SUBSCRIBER_API+"/addlocation",method:"POST",data:{location:{name:a,address:t,lat:n,lng:o}},success:function(a){}})}var o=null,e=null,i=new Array,c=!1,l="",r=40.75,d=-111.8833;o=new GMaps({div:"#location_map_container",lat:r,lng:d,zoom:11,dragend:function(a){var n=o.getCenter();r=n.G,d=n.K,c&&t(l)}}),e=$("#data-table").DataTable({deferRender:!0,dom:"frtiS",scrollY:320,scrollCollapse:!0,columnDefs:[{targets:0,width:"100px",render:function(a,t,n,o){return"<a href='javascript:;' class='add_location' data-lat='"+n[3]+"' data-lng='"+n[4]+"' data-name='"+n[1]+"' data-address='"+n[2]+"'>Add Location</a>"}},{targets:[3,4],visible:!1}]}),service=new google.maps.places.PlacesService(o.map),$("#p4_location_search_bar").keydown(function(a){13==a.keyCode&&(c=!0,t($(this).val()))}),$("#add_all_locations").click(function(){$(e.rows().data()).each(function(){location_name=this[1],location_address=this[2],location_lat=this[3],location_lng=this[4],n(location_name,location_address,location_lat,location_lng),e.rows().remove(),$("#p4_location_search_bar").val(""),c=!1,o.removeMarkers()})}),$("#data-table").on("click",".add_location",function(){var a=$(this).attr("data-name"),t=$(this).attr("data-address"),o=$(this).attr("data-lat"),e=$(this).attr("data-lng");n(a,t,o,e)}),$("#location_map_container").on("click",".add_location",function(){var a=$(this).parent(),t=a.children("h5").text(),o=a.children("p").text(),e=$(this).attr("data-lat"),i=$(this).attr("data-lng");n(t,o,e,i)})});